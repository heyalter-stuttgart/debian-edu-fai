debian-edu-fai (2023.09.26.3) unstable; urgency=medium

  * debian/control:
    + Move memtest86+ (for archs amd64 + i386) to Recommends: field as we can't
      have arch-specific dependencies in arch-all bin:pkgs. (Closes: #1052957).

 -- Mike Gabriel <sunweaver@debian.org>  Tue, 26 Sep 2023 16:53:13 +0200

debian-edu-fai (2023.09.26.2) unstable; urgency=medium

  * debian/control:
    + Fix installability on non-x86 architectures. People should at least be
      able to test those platforms.

 -- Mike Gabriel <sunweaver@debian.org>  Mon, 25 Sep 2023 09:30:53 +0200

debian-edu-fai (2023.09.26.1) unstable; urgency=medium

  [ Guido Berhoerster ]
  * Improve OS detection for loading profiles

  [ Mike Gabriel ]
  * ChangeLog: update post-release
  * bin/debian-edu-fai_install: Promote http_proxy settings into FAI config
    space and set APTPROXY variable accordingly.
  * fai/config/hooks/updatebase.DEBIAN: Debian Edu sets up http proxy
    configuration via 03debian-edu-config. To override this (which we want),
    we need to move 02proxy to 04proxy in /etc/apt/apt.conf.d/.

 -- Mike Gabriel <sunweaver@debian.org>  Mon, 25 Sep 2023 09:01:00 +0200

debian-edu-fai (2023.09.19.1) unstable; urgency=medium

  [ Mike Gabriel ]
  * {bin/debian-edu-fai_install,fai/config/class/DEBIAN.var.in}:
    + Propagate mirrorurl from debian-edu-fai.conf into FAI config space.
    + Don't use @mirrorurl@, use internally derived @apt_cdn@ variable instead.
  * files/etc/apt/sources.list.d/fai-mirror.list/FAI_MIRROR:
    + Use more generic mirror (path) URL.
  * APT sources: Use {%apt_cdn%} variable instead of hard-coded servername.
  * bin/debian-edu-fai_install:
    + Fix config file's name in comment.
  * bin/debian-edu-fai_updateconfigspace:
    + More reliably detect if we are in a Git working copy.
  * fai/config/class:
    + Add OS detection code to 40-parse-profiles.sh to support OS + version specific
      installation profiles (detect from FAI nfsroot OS + version).
  * fai/config/class:
    + Rename / add profile files, now OS + version specific.

  [ Guido Berh√∂rster ]
  * fai/config/class/40-parse-profiles.sh:
    + Adjust OS_VERSION_MAJOR population.

 -- Mike Gabriel <sunweaver@debian.org>  Tue, 19 Sep 2023 22:05:11 +0200

debian-edu-fai (2023.09.13.1) unstable; urgency=medium

  [ Guido Berhoerster ]
  * Replace nullmailer with exim4
    This corresponds to a manual installation and avoids problems with nullmailer
    such as excessive delivery attempts of all queued messages at once and
    excessive logging of such events (see discussion in #1051461).

 -- Mike Gabriel <sunweaver@debian.org>  Wed, 13 Sep 2023 08:55:53 +0200

debian-edu-fai (2023.09.09.1) unstable; urgency=medium

  [ Guido Berhoerster ]
  * Fix nullmailer configuration
    Configure the nullmailer relayhost (the default is mail.<domain>) in order to
    allow clients to actually send mail and explicitly set /etc/mailname
    (Closes: #1051461).
  * Do not append the hostname to /etc/mailname
    Do not append to /etc/mailname, the file should contain a single hostname.
    Rather create it with the default "postoffice.intern" if it does not exist yet.
    This is consistent with manual installations of Debian Edu.

 -- Mike Gabriel <sunweaver@debian.org>  Sat, 09 Sep 2023 22:51:26 +0200

debian-edu-fai (2023.09.07.1) unstable; urgency=medium

  * Debian Edu FAI for Debian bookworm.

  [ Guido Berhoerster ]
  * Rename bin/debian-edu-faiinstall to bin/debian-edu-fai_install for
    consistency with debian-edu-router.
  * Actually install /etc/security/group.conf on bullseye. From bookworm on this
    is handled via cfengine.
  * Use non-free-firmware component on bookworm and later.
    This is required for installing the firmware packages.
  * Add support for memtest86+ x64.
  * debian/control: Add explicit dependency on memtest86+.
  * Unset TMPDIR when invoking fai-make-nfsroot.
    On a DebianEdu installation pam_tmpdir is installed which sets TMPDIR to
    /tmp/user/<uid>.  This is then propagated from fai-make-nfsroot to
    debootstrap which causes maintainer scripts making use of TMPDIR (e.g. by
    calling mktemp) to fail because the directory does not exist inside the
    chroot.
  * Add some documentation about NFS exports to README.md
  * Switch to installing bookworm.
  * Ensure parent of target directory exists before copying FAI config space
    debian-edu-faiinstall does not check whether the parent of the target
    directory /srv/fai/config existed before invoking cp -a on the config space.
    Thus, if /srv/fai does no exist cp will copy /usr/share/debian-edu-fai/fai
    /config to /srv/fai instead of /srv/fai/config which is not detected until
    booting a client via PXE.  Fix this by ensuring the parent directory of
    $FAI_CONFIGDIR_REAL exists.
    Additionally do not hardcode /srv/fai which ignores that FAI_CONFIGDIR is
    configurable.
  * Disable apt proxy by default. Do not assume faiserver.intern exists. The
    proxy can be set via /etc/debian-edu/debian-edu-fai.conf.
  * Fix instructions in README.md and /etc/debian-edu/debian-edu-fai.conf
    The configuration file name is /etc/debian-edu/debian-edu-fai.conf not
    /etc/debian-edu/faiinstall.conf.
    Improve and shorten the instructions to set up SSH access for the fai user.
  * Add primary group fai for the fai user (instead of primary group
    nobody).
  * Recommend the use of yescrypt password hashes.
    This follows the default since Debian bullseye.
  * Add note about syntax to configuration.
  * Update motd for bookworm.
  * README.md: Change instructions to emphasize the need for first time
    configuration. Users should not be enticed to blindly run
    debian-edu-fai_install before actually configuring the server.
  * Ensure debian-edu-fai.conf is not world-readable
    It contains password hashes for the root account of installed clients so
    like /etc/shadow it should not be world readable.
  * Replace fetch-ldap-cert script usage with fetch-rootca-cert
    The fetch-ldap-cert init script has been obsolete and was removed
    (see #971780).

  [ Mike Gabriel ]
  * bin/debian-edu-fai_install (port over from debian-edu-router's FAI
    installation script):
    + Manage config space with ucf.
    + Echo headlines to show where we are in the script.
    + Drop support for Debian versions older than bullseye
    + Mount /proc and /sys in nfsroot
  * README.md: Typo fix.
  * {README.md,conf/debian-edu/debian-edu-fai.conf}: Adjust files to renaming
    of debian-edu-fai_install script (only in docs or comments).
  * bin/debian-edu-fai_install: Mount /proc and /sys in nfsroot
    Mount prior to creating/updating it. Those mountpoints are needed by
    dracut's  45url-libs module.
  * debian/control:
    + Bump Standards-Version: to 4.6.2. No changes needed.
  * debian/copyright:
    + Update copyright attributions.
  * lintian: Override uses-dpkg-database-directly and openpgp-file-has-
    implementation-specific-extension for given reasons.

 -- Mike Gabriel <sunweaver@debian.org>  Thu, 07 Sep 2023 21:16:37 +0200

debian-edu-fai (2023.05.16.1) unstable; urgency=medium

  * bin/debian-edu-faiinstall: Make sure FAI_CONFIGDIR_REAL is set before it
    is accessed.
  * debian/postrm: Ignore failures during execution of deluser/delgroup.
    (Closes: #1035292).

 -- Mike Gabriel <sunweaver@debian.org>  Tue, 16 May 2023 23:00:47 +0200

debian-edu-fai (2022.04.14.1) unstable; urgency=medium

  * fai/config/scripts/GRUB_EFI/10-setup:
    - Use <tab> for indentations.
    - Use backquotes, make Midnight Commanders shell syntax highlighter happier.
    - Add EFI boot manager wipe for the Dell Venue 8 Pro tablet series.
    - Explicitly set --bootnext entry to 0000 after grub-install.
  * bin/debian-edu-faiinstall:
    - Drop unused $gtkvideo variable.
    - Adjust path in comment.
    - Adjust defaults for NFSROOT and TFTPROOT according to debian-edu-fai.conf.
    - Drop duplicate value defaults for wifi_essid and wifi_passphrase.
  * debian/maintscript:
    + Rename /etc/debian-edu/faiinstall.conf to /etc/debian-edu/debian-edu-fai.
      conf.
  * Rename faiinstall.conf to debian-edu-fai.conf.
  * conf/debian-edu/fai/debian-edu-fai.TEMPLATE/nfsroot.conf.in:
    - Adjust paths of TFTPROOT and NFSROOT. More properly use our own namespace.
  * conf/debian-edu/fai/debian-edu-fai.TEMPLATE/fai.conf.in:
    - Typo fix.

  * debian/control:
    + Bump Standards-Version: to 4.6.1. No changes needed.
    + Bump Standards-Version: to 4.6.1. No changes needed.

 -- Mike Gabriel <sunweaver@debian.org>  Fri, 16 Sep 2022 20:38:21 +0200

debian-edu-fai (2022.02.22.1) unstable; urgency=medium

  * fai/config/basefiles/mk-basefile:
    + Drop file. Not needed here.
  * fai/config/scripts/EDU/50-cups-browsing:
    + Assure that CreateRemoteCUPSPrinterQueues is set to 'Yes'.
  * fai/config/class/{10-*,20-*}:
    + Update from upstream FAI config space.
  * debian/postinst:
    + Fix add user call, add user account name (which was obviously missing).
      (This resolves the current piuparts test failure).

 -- Mike Gabriel <sunweaver@debian.org>  Tue, 22 Feb 2022 21:40:11 +0100

debian-edu-fai (2022.02.09.1) unstable; urgency=medium

  * bin/debian-edu-faiinstall:
    - Fix script failure if /srv/tftp/ltsp does not exist.
    - Obviously 'test -d' is true for symlinks that point to a directory. In
      that case, we need to be more precise.
    - Fix school_tag (for those, who use it)
  * fai/config/package_config/STANDARD:
    - python{,-minimal} are virtual, let's use python3{,-minimal} instead.

 -- Mike Gabriel <sunweaver@debian.org>  Wed, 09 Feb 2022 20:45:21 +0100

debian-edu-fai (2022.01.31.1) unstable; urgency=medium

  * Initial release to Debian. (Closes: #1004675).

 -- Mike Gabriel <sunweaver@debian.org>  Mon, 31 Jan 2022 16:47:23 +0100
